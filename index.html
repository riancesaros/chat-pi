<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>IA Analisadora de Voo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #e6ffe6;
      color: #004d00;
      padding: 2em;
    }
    #resultado {
      margin-top: 2em;
      background: #ffffff;
      padding: 1em;
      border-left: 5px solid #008000;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h1>üõ∏ Analisador de Logs de Drone com IA</h1>
  <p>Fa√ßa upload do seu arquivo de log (.json):</p>
  <input type="file" id="fileInput" accept=".json"><br><br>
  <input type="text" id="chave" placeholder="Digite sua chave da API" style="width:300px;"><br><br>
  <button onclick="enviarParaIA()">Analisar com IA</button>

  <div id="resultado">Nenhum resultado ainda.</div>

  <script>
  let logContent = '';

  document.getElementById('fileInput').addEventListener('change', function (e) {
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = function (event) {
      try {
        logContent = JSON.parse(event.target.result);
        document.getElementById('resultado').textContent = '‚úÖ Log carregado com sucesso. Pronto para an√°lise.';
      } catch (err) {
        document.getElementById('resultado').textContent = '‚ùå Erro ao ler JSON.';
      }
    };
    reader.readAsText(file);
  });

  async function enviarParaIA() {
    const apiKey = document.getElementById('chave').value.trim();
    if (!apiKey) return alert("Informe a chave da API.");
    if (!logContent) return alert("Carregue o log primeiro.");

    const prompt = `Voc√™ √© um especialista em engenharia de drones. Analise o seguinte log de voo e identifique comportamentos anormais, erros operacionais e sugira melhorias para a miss√£o. Seja detalhado e t√©cnico.

LOG:
${JSON.stringify(logContent, null, 2)}
`;

    document.getElementById('resultado').textContent = '‚è≥ Enviando para IA...';

    try {
      const resposta = await fetch("https://openrouter.ai/api/v1/chat/completions", {
        method: "POST",
        headers: {
          "Authorization": "Bearer " + apiKey,
          "Content-Type": "application/json",
          "HTTP-Referer": "https://riancesaros.github.io/chat-pi/",
          "X-Title": "LogAnalizer"
        },
        body: JSON.stringify({
          model: "openai/gpt-3.5-turbo",
          temperature: 0.3,
          max_tokens: 1500,
          messages: [{ role: "user", content: prompt }]
        })
      });

      const json = await resposta.json();
      const respostaIA = json.choices?.[0]?.message?.content || "Sem resposta da IA.";
      document.getElementById('resultado').textContent = respostaIA;

    } catch (error) {
      console.error("Erro ao enviar para a IA:", error);
      document.getElementById('resultado').textContent = '‚ùå Erro ao obter resposta da IA.';
    }
  }
</script>

</body>
</html>
